<!DOCTYPE html>
<html lang="en">
  <head>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
    <link rel="stylesheet" type="text/css" href="./stylesheets/app.css">
    <link rel="stylesheet" type="text/css" href="./stylesheets/list.css">
    <link rel="stylesheet" type="text/css" href="./stylesheets/list_card.css">
    <link rel="stylesheet" type="text/css" href="./stylesheets/members.css">
    <link rel="stylesheet" type="text/css" href="./stylesheets/card.css">
    <link rel="stylesheet" type="text/css" href="./stylesheets/comment.css">
    <link rel="stylesheet" type="text/css" href="./stylesheets/add_card.css">
  </head>

  <body>
    <div id="App"></div>
  </body>

  <script type="text/jsx">
    import React from 'react'
    import ReactDOM from 'react-dom'
    import ss from 'slack-signaler'
    import webrtc from './webrtc'

    let doc_id = 7777
    let token = process.env.SLACK_BOT_TOKEN
    let bot = ss.init({doc_id: doc_id, bot_token: token })
    console.log("WEBRTC",webrtc)

    var globopeer;
    webrtc.ondatachannel = (peer) => { 
      console.log("Data channel open!"); globopeer = peer
      globopeer.data_channel.onmessage = (msg) => 
        app.state.store.dispatch({type: "MERGE_DOCUMENT", file: msg.data})
    }
    webrtc.join(bot)

    // this breaks for large boards.

    const render = () => {
      const App = require('./components/app').default
      ReactDOM.render(<App />, document.getElementById('App'))
    }

    render()
  </script>
</html>
